(function() {
    if (!Contentstack) {
        alert('Please add Contentstack Library');
    } else {
        console.log(Contentstack);
        var clearAll = document.getElementById('all');
        var clearByContentType = document.getElementById('content_type');
        var clearByQuery = document.getElementById('query');
        var wrapper, Stack;

        function DOMCreation(entry, html) {
            if (entry) {
                html += '<div class="panel panel-default"><div class="panel-heading" role="tab"><h4 class="panel-title"><a role="button" data-toggle="collapse" data-parent="#accordion" href="#' + entry.uid + '" aria-expanded="true" aria-controls="' + entry.uid + '">';
                html += entry.title + '</a></h4></div><div id="' + entry.uid + '" class="panel-collapse collapse" role="tabpanel"><div class="panel-body">';
                html += entry.body + ' </div></div></div>';
            }
            return html;
        }

        function singleEntry(contentTypeUid, entryUid) {
            var contentTypeUid = contentTypeUid || "news"
            var entryUid = entryUid || "news_uid"

            Stack
                .ContentType(contentTypeUid)
                .Entry(entryUid)
                .fetch()
                .then(function(data) {
                    // result object with entry
                    var html = '<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">';
                    html = DOMCreation(data.toJSON(), html);
                    html += '</div>';
                    wrapper.innerHTML = html;
                }, function(err) {
                    console.info('News could not fetched.');
                });
        }

        function allEntries(contentTypeUid) {
            var contentTypeUid = contentTypeUid || "news";
            Stack
                .ContentType(contentTypeUid)
                .Query()
                .find()
                .then(function(data) {
                    if (data && data.length && data[0].length) {
                        var html = '<div class="panel-group" id="accordion" role="tablist" aria-multiselectable="true">';
                        for (var i = 0, _i = data[0].length; i < _i; i++) {
                            html = DOMCreation(data[0][i].toJSON(), html);
                        }
                        html += '</div>';
                        wrapper.innerHTML = html;
                    } else {
                        console.info('News could not fetched.');
                    }
                }, function(err) {
                    console.info('Error : ' + err);
                    console.log(err);
                });
        }

        function getAsset() {
            Stack
                .Assets()
                .Query()
                .toJSON()
                .find()
                .spread(function(result) {
                    console.info("Result2 : ", result)
                    for (let i = 0, _i = result.length; i < _i; i++) {
                        // Image optimization
                        const imgUrl = Stack.imageTransform(result[i]['url'], {
                            quality: 50,
                            format: 'jpg'
                        })
                        console.log("Image URL : ", imgUrl)
                    }
                }, function(err) {
                    // body...
                    console.info("Error: " + err);
                });
        }



        window.onload = function() {
            wrapper = document.getElementById('wrapper')
            Stack = Contentstack.Stack({ 'api_key': '', 'delivery_token': '', 'environment': '' })
            Stack.setCachePolicy(Contentstack.CachePolicy.NETWORK_ELSE_CACHE);
            // get all the entries
            allEntries("news")

            // get all the assets
           // getAsset();
        }
    }
}());